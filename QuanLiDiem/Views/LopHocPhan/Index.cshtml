@model IEnumerable<QuanLiDiem.Models.LopHocPhan>

@using QuanLiDiem.Models

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản Lí Lớp Học Phần</title>
    <link href="~/css/style.css" rel="stylesheet" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>
    @if (TempData["SuccessMessage"] != null)
    {
        <div id="success-alert" class="alert alert-success alert-dismissible fade show">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    <h2>Quản lí danh sách lớp học phần</h2>

    <div class="header-container">
        <!-- Phần Lịch sử và dropdown -->
        <div class="lichsu d-flex align-items-center">
            <!-- Lịch sử và bảng chọn -->
            <div class="history">
                <h3 class="me-3">Lịch sử</h3>
                <form id="filterForm" method="get" action="/LopHocPhan/Index">
                    <select id="filter" name="filter" onchange="this.form.submit()" class="form-select form-select-sm">
                        <option value="date">Theo ngày tạo</option>
                        <option value="tenLopHocPhan">Theo tên lớp học phần</option>
                        <option value="tenGiangVien">Theo tên giảng viên</option>
                        <option value="maLop">Theo mã lớp</option>
                    </select>
                </form>
            </div>
            <!-- Tìm kiếm nằm ở giữa -->
            <div class="search-section d-flex align-items-center mb-3">
                <!-- Input tìm kiếm -->
                <form asp-action="Search" method="get" class="d-flex">
                    <input type="text" name="search" class="form-control form-control-sm me-2"
                           placeholder="Tìm kiếm..." value="@ViewBag.SearchQuery" />
                    <button type="submit" class="btn btn-secondary btn-sm">
                        <i class="fas fa-search"></i> <!-- Icon kính lúp -->
                    </button>
                </form>
            </div>

            <!-- Nút tạo mới nằm ở bên phải -->
            <div class="create-section">
                <a asp-controller="LopHocPhan" asp-action="Create" class="btn btn-success">Tạo</a>
            </div>
        </div>
    </div>




    @if (Model != null && Model.Any())
    {

        <table id="lopHocPhanTable" class="display">
            <thead>
                <tr>
                    <th>Mã lớp học phần</th>
                    <th>Tên lớp học phần</th>
                    <th>Mã giảng viên</th>
                    <th>Tên giảng viên</th>
                    <th>Thời gian cập nhật</th>
                    <th>Ngày bắt đầu</th>
                    <th>Ngày kết thúc</th>
                    <th class="ghi-chu">Ghi chú</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.MaHP</td>
                        <td><a href="@Url.Action("Index", "DanhSachLop", new { maHP = item.MaHP })">@item.TenHP</td>
                        <td>@item.MaGV</td>
                        <td>@item.MaGVNavigation?.TenGV</td>
                        <td>@item.NgayTao?.ToString("d")</td>
                        <td>@item.NgayBatDau?.ToString("d")</td>
                        <td>@item.NgayKetThuc?.ToString("d")</td>
                        <td class="ghi-chu">@item.GhiChu</td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.MaHP" asp-route-search="@ViewBag.SearchQuery" class="btn btn-primary">Sửa</a>
                            <form action="@Url.Action("Delete", new { id = item.MaHP, search = ViewBag.SearchQuery })" method="post" style="display:inline;">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Bạn có chắc chắn muốn xóa lớp học phần này?')">Xóa</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>No data available</p>
    }

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const filter = new URLSearchParams(window.location.search).get("filter");
            if (filter) {
                document.getElementById("filter").value = filter;
            }
        });
                // JavaScript để tự động ẩn thông báo sau 3 giây
            setTimeout(function () {
            var alert = document.getElementById('success-alert');
            if (alert) {
                var bootstrapAlert = new bootstrap.Alert(alert);
                bootstrapAlert.close(); // Sử dụng chức năng đóng của Bootstrap
            }
        }, 3000);
    </script>
</body>
</html>
